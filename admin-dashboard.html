<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة تحكم المدير - DREAM TIME</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href=" https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css ">
  <style>
   /* تحسين الخطوط */
    body {
      font-family: 'Tajawal', sans-serif;
      margin: 0;
      background-color: #f9fafb;     
    }
    header {
      background: linear-gradient(135deg, #2c3e50, #ff87f1);
      color: white;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    header h1 {
      font-size: 1.8rem;
      margin: 0;
    }
    /* تحسين القائمة الجانبية */
    .container {
      display: flex;
      min-height: 90vh;
    }
    .sidebar {
      width: 250px;
      background: linear-gradient(135deg, #ffffff, #f0f2f5);
      padding: 1.5rem;
      border-right: 1px solid #e0e0e0;
      box-shadow: 2px 0 6px rgba(0, 0, 0, 0.05);
    }
    .sidebar button {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 12px;
      margin-bottom: 8px;
      background-color: #fff;
      color: #333;
      border: none;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .sidebar button:hover {
      background-color: #f0f2f5;
      transform: translateY(-2px);
    }
    .sidebar button i {
      margin-left: 10px;
      color: #3498db;
    }
    .submenu {
      margin-top: 10px;
      display: none;
    }
    .submenu button {
      background-color: #f9fafb;
      padding-left: 30px;
      color: #555;
    }
    /* تحسين المحتوى الرئيسي */
    .content {
      flex-grow: 1;
      padding: 2rem;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      margin-left: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
      background-color: #f9fafb;
    }
    th {
      background-color: #3498db;
      color: white;
    }
    img {
      max-width: 80px;
      height: auto;
      object-fit: cover;
      border-radius: 6px;
    }
    /* تحسين النموذج */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: #ffffff;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    .close-btn {
      float: right;
      font-size: 1.5rem;
      cursor: pointer;
      color: #3498db;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    input, select, textarea {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
    }
    button {
      padding: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      background-color: #2980b9;
      transform: translateY(-1px);
    }
    /* تحسين معاينة الصور */
    .image-preview {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }
    .image-preview img {
      max-width: 150px;
      height: auto;
      border: 2px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    /* تحسين الأزرار */
    .action-buttons {
      display: flex;
      gap: 10px;
    }
    .action-buttons button {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .action-buttons button.edit {
      background-color: #2ecc71;
      color: white;
    }
    .action-buttons button.delete {
      background-color: #e74c3c;
      color: white;
    }
    .action-buttons button.view {
      background-color: #3498db;
      color: white;
    }
    .action-buttons button.complete {
      background-color: #27ae60;
      color: white;
    }
    .action-buttons button:hover {
      transform: scale(1.1);
    }
    .order-details {
      background: #f0f2f5;
      padding: 10px;
      border-left: 4px solid #3498db;
      margin-top: 10px;
    }
    .product-detail {
      margin-bottom: 10px;
      font-size: 0.9rem;
    }
    .product-detail img {
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .video-preview video {
      max-width: 200px;
      margin: 5px;
    }
    .video-container {
      position: relative;
    }
    .video-delete-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #e74c3c;
      color: white;
      border: none;
      padding: 3px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
  </style>
</head>
<body>
 
  <header>
  <h1 id="headerTitle">لوحة تحكم المدير - DREAM TIME</h1>
</header>
<div class="container">
  <div class="sidebar">
    <button onclick="toggleSubMenu('home-settings')"><i class="fas fa-cog"></i> إعدادات الصفحة الرئيسية</button>
    <div class="submenu" id="home-settings-submenu">
      <button onclick="showSection('add-product')"><i class="fas fa-plus"></i> إضافة منتج جديد</button>
      <button onclick="showSection('products')"><i class="fas fa-list"></i> إدارة المنتجات</button>
    </div>
 
  <button onclick="showVideoSection()"><i class="fas fa-video"></i> إدارة الفيديوهات</button>
  <button onclick="showSection('manage-product-images')"><i class="fas fa-images"></i> إدارة صور المنتج</button>
    <button onclick="showSection('orders')"><i class="fas fa-shopping-cart"></i> عرض طلبات الزبون</button>
    <button onclick="showCompletedOrders()"><i class="fas fa-check-circle"></i> الطلبات الجاهزة</button>
  </div>
   <div class="content" id="mainContent">
    <h2>مرحبًا بك في لوحة التحكم</h2>
    <p>اختر خيارًا من القائمة الجانبية لإدارة المتجر.</p>
  </div>
</div>
<!-- نموذج تعديل المنتج -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeEditModal()">&times;</span>
    <h2>تعديل المنتج</h2>
    <input type="hidden" id="editProductId" />
    <div class="form-group">
      <label>الاسم:</label>
      <input type="text" id="editName" />
    </div>
    <div class="form-group">
      <label>السعر:</label>
      <input type="number" id="editPrice" />
    </div>
    <div class="form-group">
      <label>الوصف:</label>
      <textarea id="editDesc"></textarea>
    </div>
    <div class="form-group">
      <label>رفع صورة:</label>
      <input type="file" id="editImageFile" accept="image/*" onchange="previewImage(event, 'editImagePreview')">
      <div class="image-preview" id="editImagePreview"></div>
    </div>
    <div class="form-group">
      <label>النوع:</label>
      <select id="editType">
        <option value="خليجي">خليجي</option>
        <option value="عبايات سوداء تقليدي">عبايات سوداء تقليدي</option>
        <option value="عبايات تطريز خفيف">عبايات تطريز خفيف</option>
        <option value="عبايات ملونة">عبايات ملونة</option>
        <option value="عبايات تركية">عبايات تركية</option>
        <option value="عبايات مطرزة">عبايات مطرزة</option>
      </select>
    </div>
    <button onclick="saveEditedProduct()">حفظ التغييرات</button>
  </div>
</div>

  <!-- نموذج تعديل الفيديوهات -->
  <div class="modal" id="editVideosModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeEditVideosModal()">&times;</span>
      <h2>إدارة فيديوهات المنتج</h2>
      <input type="hidden" id="editVideosProductId" />
      <div class="form-group">
        <label>الفيديوهات الحالية:</label>
        <div id="currentVideosPreview" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
      </div>
      <div class="form-group">
        <label>رفع فيديوهات جديدة:</label>
        <input type="file" id="newVideoFiles" accept="video/*" multiple onchange="previewVideos(event, 'newVideosPreview')">
        <div class="video-preview" id="newVideosPreview"></div>
      </div>
      <button onclick="saveEditedVideos()">حفظ التغييرات</button>
    </div>
  </div>
<!-- نموذج تعديل الصور -->
<div class="modal" id="editImagesModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeEditImagesModal()">&times;</span>
    <h2>تعديل صور المنتج</h2>
    <input type="hidden" id="editImagesProductId" />
    <div class="form-group">
      <label>الصور الحالية:</label>
      <div id="currentImagesPreview" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
    </div>
    <div class="form-group">
      <label>رفع صور جديدة:</label>
      <input type="file" id="newImageFiles" accept="image/*" multiple onchange="previewImages(event, 'newImagesPreview')">
      <div class="image-preview" id="newImagesPreview"></div>
    </div>
    <button onclick="saveEditedImages()">حفظ التغييرات</button>
  </div>
</div>
<!-- في نفس ملف HTML أضف هذا الكود قبل نهاية body -->
<div class="modal" id="editVideosModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeEditVideosModal()">&times;</span>
    <h2>إدارة فيديوهات المنتج</h2>
    <input type="hidden" id="editVideosProductId" />
    <div class="form-group">
      <label>الفيديوهات الحالية:</label>
      <div id="currentVideosPreview" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
    </div>
    <div class="form-group">
      <label>رفع فيديوهات جديدة:</label>
      <input type="file" id="newVideoFiles" accept="video/*" multiple onchange="previewVideos(event, 'newVideosPreview')">
      <div class="video-preview" id="newVideosPreview"></div>
    </div>
    <button onclick="saveEditedVideos()">حفظ التغييرات</button>
  </div>
</div>
 
</body>
<script>
  let products = [];
  let orders = [];
  let completedOrders = [];

  // جلب البيانات من localStorage عند تحميل الصفحة
  if (localStorage.getItem("dreamtime_products")) {
    products = JSON.parse(localStorage.getItem("dreamtime_products"));
  } else {
    products = [
      { id: 1, name: "خليجي", price: 10000, image:"صور المنتجات/خليجي/a.jpg", description: "عبايه ذات خامه ناعمه مثل الحرير.", type: "خليجي", images: ["صور المنتجات/خليجي/a.jpg", "صور المنتجات/خليجي/b.jpg"] },
      { id: 2, name: "عبايات سوداء تقليدي", price: 7500, image: "صور المنتجات/عبايات سوداء تقليدي/a.jpg", type: "عبايات سوداء تقليدي", images: ["صور المنتجات/عبايات سوداء تقليدي/a.jpg", "صور المنتجات/عبايات سوداء تقليدي/b.jpg"] },
      { id: 3, name: "عبايات تطريز خفيف", price: 8000, image: "صور المنتجات/عبايات تطريز خفيف/a.jpg", type: "عبايات تطريز خفيف", images: ["صور المنتجات/عبايات تطريز خفيف/a.jpg", "صور المنتجات/عبايات تطريز خفيف/b.jpg", "صور المنتجات/عبايات تطريز خفيف/c.jpg"] }
    ];
  }
  if (localStorage.getItem("dreamtime_orders")) {
    orders = JSON.parse(localStorage.getItem("dreamtime_orders"));
  }
  if (localStorage.getItem("dreamtime_completed_orders")) {
    completedOrders = JSON.parse(localStorage.getItem("dreamtime_completed_orders"));
  } else {
    localStorage.setItem("dreamtime_completed_orders", JSON.stringify([]));
  }

  function showSection(section) {
    const content = document.getElementById("mainContent");
    let html = "";

    if (section === 'add-product') {
      html = `
        <h2>إضافة منتج جديد</h2>
        <div class="form-group">
          <label>الاسم:</label>
          <input type="text" id="newName" placeholder="اسم المنتج" />
        </div>
        <div class="form-group">
          <label>السعر:</label>
          <input type="number" id="newPrice" placeholder="السعر" />
        </div>
        <div class="form-group">
          <label>الوصف:</label>
          <textarea id="newDesc" placeholder="وصف المنتج"></textarea>
        </div>
        <div class="form-group">
          <label>النوع:</label>
          <select id="newType">
            <option value="خليجي">خليجي</option>
            <option value="عبايات سوداء تقليدي">عبايات سوداء تقليدي</option>
            <option value="عبايات تطريز خفيف">عبايات تطريز خفيف</option>
            <option value="عبايات ملونة">عبايات ملونة</option>
            <option value="عبايات تركية">عبايات تركية</option>
            <option value="عبايات مطرزة">عبايات مطرزة</option>
          </select>
        </div>
        <div class="form-group">
          <label>رفع الصور:</label>
          <input type="file" id="newImageFiles" accept="image/*" multiple onchange="previewImages(event, 'newImagesPreview')">
          <div class="image-preview" id="newImagesPreview"></div>
        </div>
        <button onclick="saveProduct()">حفظ المنتج</button>
      `;
    } else if (section === 'products') {
      html = `
        <h2>إدارة المنتجات</h2>
        <table>
          <tr>
            <th>الاسم</th>
            <th>السعر</th>
            <th>النوع</th>
            <th>الإجراءات</th>
          </tr>
          ${products.map(product => `
            <tr>
              <td>${product.name}</td>
              <td>${product.price} ريال</td>
              <td>${product.type}</td>
              <td>
                <button class="edit" onclick="openEditModal(${product.id})">تعديل</button>
                <button class="delete" onclick="deleteProduct(${product.id})">حذف</button>
                <button class="view" onclick="editProductImages(${product.id})">إدارة الصور</button>
              </td>
            </tr>
          `).join("")}
        </table>
      `;
    } else if (section === 'manage-product-images') {
      html = `
        <h2>إدارة صور المنتج</h2>
        <p>اختر منتجًا لإدارة صوره:</p>
        <div id="productImageList">
          ${products.map(product => `
            <div style="margin-bottom: 10px;">
              <strong>${product.name}</strong>
              <button onclick="editProductImages(${product.id})">إدارة الصور</button>
            </div>
          `).join("")}
        </div>
      `;
    } else if (section === 'orders') {
      html = `
        <h2>طلبات الزبون</h2>
        <table>
          <tr>
            <th>رقم الطلب</th>
            <th>اسم الزبون</th>
            <th>المنتجات</th>
            <th>الإجراءات</th>
          </tr>
          ${orders.map(order => {
            const productsInOrder = order.products || [];
            const productsList = productsInOrder.map(p => {
              const product = products.find(prod => prod.id === p.productId);
              return `
                <div class="product-detail">
                  <strong>المنتج:</strong> ${product ? product.name : "غير موجود"}<br>
                  <strong>الكمية:</strong> ${p.quantity}<br>
                  <strong>المقاس:</strong> ${p.size}<br>
                  <strong>الموقع:</strong> ${p.location}<br>
                  <img src="${product ? product.image : 'https://via.placeholder.com/80  '}" alt="صورة المنتج" style="max-width: 80px;">
                </div>
                
              
              `;
            }).join("");
            return `
              <tr>
                <td>${order.orderId}</td>
                <td>${order.customerName}</td>
                <td>
                  <button onclick="toggleDetails(${order.orderId})">عرض التفاصيل</button>
                  <div id="details-${order.orderId}" class="order-details" style="display: none;">
                    ${productsList}
                  </div>
                <td>
                  <button class="delete" onclick="deleteOrder(${order.orderId})"><i class="fas fa-trash"></i> حذف</button>
                  <button class="complete" onclick="markAsCompleted(${order.orderId})"><i class="fas fa-check-circle"></i> تم الاستلام</button>
                </td>
              </tr>`;
              
          }).join("")}
        </table>`;
    } else if (section === 'completed-orders') {
      html = `
        <h2>الطلبات الجاهزة</h2>
        <table>
          <tr>
            <th>رقم الطلب</th>
            <th>اسم الزبون</th>
            <th>المنتج</th>
            <th>المقاس</th>
            <th>الموقع</th>
            <th>الكمية</th>
            <th>صورة المنتج</th>
          </tr>
          ${completedOrders.map(order => {
            const product = products.find(p => p.id === order.productId);
            return `
              <tr>
                <td>${order.orderId}</td>
                <td>${order.customerName}</td>
                <td>${product ? product.name : "غير موجود"}</td>
                <td>${order.size || "غير محدد"}</td>
                <td>${order.location || "غير محدد"}</td>
                <td>${order.quantity || "غير محددة"}</td>
                <td>
                  ${product ? `<img src="${product.image}" alt="صورة المنتج">` : "لا يوجد"}
                </td>
              </tr>`;
          }).join("")}
        </table>`;
    }

    content.innerHTML = html;
  }

  function toggleDetails(orderId) {
    const details = document.getElementById(`details-${orderId}`);
    details.style.display = details.style.display === "block" ? "none" : "block";
  }

  function showCompletedOrders() {
    const content = document.getElementById("mainContent");
    let html = `
      <h2>الطلبات الجاهزة</h2>
      <table>
        <tr>
          <th>رقم الطلب</th>
          <th>اسم الزبون</th>
          <th>المنتج</th>
          <th>المقاس</th>
          <th>الموقع</th>
          <th>الكمية</th>
          <th>صورة المنتج</th>
        </tr>
        ${completedOrders.map(order => {
          const product = products.find(p => p.id === order.productId);
          return `
            <tr>
              <td>${order.orderId}</td>
              <td>${order.customerName}</td>
              <td>${product ? product.name : "غير موجود"}</td>
              <td>${order.size || "غير محدد"}</td>
              <td>${order.location || "غير محدد"}</td>
              <td>${order.quantity || "غير محددة"}</td>
              <td>
                ${product ? `<img src="${product.image}" alt="صورة المنتج">` : "لا يوجد"}
              </td>
            </tr>`;
        }).join("")}
      </table>`;
    content.innerHTML = html;
  }

  function markAsCompleted(orderId) {
    const index = orders.findIndex(o => o.orderId === orderId);
    if (index > -1) {
      const completedOrder = orders.splice(index, 1)[0];
      completedOrders.push(completedOrder);
      localStorage.setItem("dreamtime_orders", JSON.stringify(orders));
      localStorage.setItem("dreamtime_completed_orders", JSON.stringify(completedOrders));
      alert("تم نقل الطلب إلى قسم الطلبات الجاهزة!");
      showSection('orders');
    }
  }

  function deleteOrder(orderId) {
    if (!confirm("هل أنت متأكد من حذف هذا الطلب؟")) return;
    const index = orders.findIndex(o => o.orderId === orderId);
    if (index > -1) {
      orders.splice(index, 1);
      localStorage.setItem("dreamtime_orders", JSON.stringify(orders));
      alert("تم حذف الطلب بنجاح!");
      showSection('orders');
    }
  }

 function previewImages(event, previewId) {
  const files = event.target.files;
  const preview = document.getElementById(previewId);
  preview.innerHTML = "";
  for (let file of files) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const img = document.createElement("img");
      img.src = e.target.result;
      img.style.maxWidth = "100px";
      img.style.height = "auto";
      img.style.margin = "5px";
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
}

 function saveProduct() {
  const name = document.getElementById("newName").value;
  const price = parseFloat(document.getElementById("newPrice").value);
  const desc = document.getElementById("newDesc").value;
  const imageFiles = document.getElementById("newImageFiles").files;
  const type = document.getElementById("newType").value;

  if (!name || !price || !type || imageFiles.length === 0) {
    alert("يرجى ملء جميع الحقول وإضافة صور.");
    return;
  }

  const images = [];
  for (let i = 0; i < imageFiles.length; i++) {
    const file = imageFiles[i];
    const reader = new FileReader();
    reader.onload = function(e) {
      images.push(e.target.result); // حفظ الصورة كـ Base64
      if (images.length === imageFiles.length) {
        // إنشاء المنتج بعد تحميل جميع الصور
        const id = products.length ? Math.max(...products.map(p => p.id)) + 1 : 1;
        const product = {
          id,
          name,
          price,
          description: desc,
          image: images[0], // الصورة الرئيسية
          images, // جميع الصور
          type
        };
        products.push(product);
        localStorage.setItem("dreamtime_products", JSON.stringify(products));
        alert("تم حفظ المنتج!");
        showSection('products');
      }
      html += `<td><img src="${product.image}" alt="صورة المنتج" style="max-width: 80px;"></td>`;
    };
    reader.readAsDataURL(file); // تحويل الصورة إلى Base64
  }
}

  function openEditModal(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    document.getElementById("editProductId").value = product.id;
    document.getElementById("editName").value = product.name;
    document.getElementById("editPrice").value = product.price;
    document.getElementById("editDesc").value = product.description;
    document.getElementById("editType").value = product.type;
    const preview = document.getElementById("editImagePreview");
   preview.innerHTML = "";
product.images.forEach(src => {
  const img = document.createElement("img");
  img.src = src;
  img.style.maxWidth = "100px";
  img.style.height = "auto";
  preview.appendChild(img);
});
    document.getElementById("editModal").style.display = "flex";
  }

  function saveEditedProduct() {
    const id = parseInt(document.getElementById("editProductId").value);
    const name = document.getElementById("editName").value;
    const price = parseFloat(document.getElementById("editPrice").value);
    const desc = document.getElementById("editDesc").value;
    const type = document.getElementById("editType").value;
    if (!name || !price || !type) {
      alert("يرجى ملء جميع الحقول.");
      return;
    }
    const index = products.findIndex(p => p.id === id);
    if (index !== -1) {
      const imageFiles = document.getElementById("editImageFile").files;
      if (imageFiles.length > 0) {
        const images = [];
        for (let file of imageFiles) {
          const reader = new FileReader();
          reader.onload = function(e) {
            images.push(e.target.result);
            if (images.length === imageFiles.length) {
              products[index] = { ...products[index], name, price, description: desc, image: images[0], images, type };
              localStorage.setItem("dreamtime_products", JSON.stringify(products));
              alert("تم تحديث المنتج!");
              showSection('products');
              closeEditModal();
            }
            html += `<td><img src="${product.image}" alt="صورة المنتج" style="max-width: 80px;"></td>`;
          };
          reader.readAsDataURL(file);
        }
      } else {
        products[index] = { ...products[index], name, price, description: desc, type };
        localStorage.setItem("dreamtime_products", JSON.stringify(products));
        alert("تم تحديث المنتج!");
        showSection('products');
        html += `<td><img src="${product.image}" alt="صورة المنتج" style="max-width: 80px;"></td>`;
        closeEditModal();
      }
    }
  }

  function deleteProduct(id) {
    if (!id) {
      console.error("Product ID is undefined!");
      alert("حدث خطأ: لا يمكن العثور على معرّف المنتج.");
      return;
    }
    if (!confirm("هل أنت متأكد من حذف هذا المنتج؟")) return;
    const index = products.findIndex(p => p.id === id);
    if (index > -1) {
      products.splice(index, 1);
      localStorage.setItem("dreamtime_products", JSON.stringify(products));
      showSection('products');
    }
    html += `<td><img src="${product.image}" alt="صورة المنتج" style="max-width: 80px;"></td>`;
  }

  function closeEditModal() {
    document.getElementById("editModal").style.display = "none";
    document.getElementById("editImagePreview").innerHTML = "";
    document.getElementById("editImageFile").value = "";
  }

  function viewProduct(id) {
    const product = products.find(p => p.id === id);
    if (!product) return;
    alert(`
      اسم المنتج: ${product.name}
      السعر: ${product.price} ريال
      النوع: ${product.type}
      الوصف: ${product.description}
    `);
  }

  function toggleSubMenu(submenuId) {
    const submenu = document.getElementById(submenuId + "-submenu");
    if (submenu.style.display === "block") {
      submenu.style.display = "none";
    } else {
      submenu.style.display = "block";
    }
  }

  function editProductImages(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    document.getElementById("editImagesProductId").value = product.id;
    const currentImagesPreview = document.getElementById("currentImagesPreview");
    currentImagesPreview.innerHTML = "";
    if (product.images && product.images.length > 0) {
      product.images.forEach((src, index) => {
        const imgContainer = document.createElement("div");
        imgContainer.style.position = "relative";
        imgContainer.style.display = "inline-block";
        const img = document.createElement("img");
        img.src = src;
        img.style.maxWidth = "100px";
        img.style.height = "auto";
        img.style.border = "1px solid #ddd";
        img.style.borderRadius = "6px";
        const deleteButton = document.createElement("button");
        deleteButton.innerText = "حذف";
        deleteButton.style.position = "absolute";
        deleteButton.style.top = "5px";
        deleteButton.style.right = "5px";
        deleteButton.style.backgroundColor = "#e74c3c";
        deleteButton.style.color = "white";
        deleteButton.style.border = "none";
        deleteButton.style.borderRadius = "4px";
        deleteButton.style.cursor = "pointer";
        deleteButton.onclick = () => deleteImage(productId, index);
        imgContainer.appendChild(img);
        imgContainer.appendChild(deleteButton);
        currentImagesPreview.appendChild(imgContainer);
      });
    } else {
      currentImagesPreview.innerHTML = "<p>لا توجد صور لهذا المنتج.</p>";
    }
    document.getElementById("editImagesModal").style.display = "flex";
  }

  function deleteImage(productId, imageIndex) {
    const product = products.find(p => p.id === productId);
    if (!product || !product.images || imageIndex < 0 || imageIndex >= product.images.length) return;
    product.images.splice(imageIndex, 1);
    localStorage.setItem("dreamtime_products", JSON.stringify(products));
    alert("تم حذف الصورة بنجاح!");
    editProductImages(productId);
  }

  function saveEditedImages() {
    const productId = parseInt(document.getElementById("editImagesProductId").value);
    const product = products.find(p => p.id === productId);
    if (!product) return;
    const newImageFiles = document.getElementById("newImageFiles").files;
    if (newImageFiles.length > 0) {
      for (let file of newImageFiles) {
        const reader = new FileReader();
        reader.onload = function(e) {
          product.images.push(e.target.result);
          if (product.images.length === product.images.filter(img => img).length + newImageFiles.length) {
            localStorage.setItem("dreamtime_products", JSON.stringify(products));
            alert("تم تحديث الصور بنجاح!");
            closeEditImagesModal();
            showSection('manage-product-images');
          }
        };
        reader.readAsDataURL(file);
      }
    } else {
      alert("لم يتم إضافة صور جديدة.");
    }
  }

  function closeEditImagesModal() {
    document.getElementById("editImagesModal").style.display = "none";
    document.getElementById("newImageFiles").value = "";
    document.getElementById("newImagesPreview").innerHTML = "";
  }

  // تعريف الدوال الجديدة لإدارة الفيديوهات
  function showVideoSection() {
    const content = document.getElementById("mainContent");
    let html = `
      <h2>إدارة الفيديوهات</h2>
      <p>اختر منتجًا لإدارة فديوهاته:</p>
      <div id="productVideoList">
        ${products.map(product => `
          <div style="margin-bottom: 10px;">
            <strong>${product.name}</strong>
            <button onclick="editProductVideos(${product.id})">إدارة الفيديوهات</button>
          </div>
        `).join("")}
      </div>
    `;
    content.innerHTML = html;
  }

  function editProductVideos(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    
    document.getElementById("editVideosProductId").value = product.id;
    
    // عرض الفيديوهات الحالية
    const currentVideosPreview = document.getElementById("currentVideosPreview");
    currentVideosPreview.innerHTML = "";
    if (product.videos && product.videos.length > 0) {
      product.videos.forEach((src, index) => {
        const videoContainer = document.createElement("div");
        videoContainer.className = "video-container";
        
        const video = document.createElement("video");
        video.src = src;
        video.controls = true;
        video.style.maxWidth = "200px";
        video.style.margin = "5px";
        
        const deleteButton = document.createElement("button");
        deleteButton.className = "video-delete-btn";
        deleteButton.innerText = "حذف";
        deleteButton.onclick = () => deleteVideo(productId, index);
        
        videoContainer.appendChild(video);
        videoContainer.appendChild(deleteButton);
        currentVideosPreview.appendChild(videoContainer);
      });
    } else {
      currentVideosPreview.innerHTML = "<p>لا توجد فيديوهات لهذا المنتج.</p>";
    }
    
    document.getElementById("editVideosModal").style.display = "flex";
  }

  function deleteVideo(productId, videoIndex) {
    const product = products.find(p => p.id === productId);
    if (!product || !product.videos || videoIndex < 0 || videoIndex >= product.videos.length) return;
    
    product.videos.splice(videoIndex, 1);
    localStorage.setItem("dreamtime_products", JSON.stringify(products));
    alert("تم حذف الفيديو بنجاح!");
    editProductVideos(productId);
  }

  function saveEditedVideos() {
    const productId = parseInt(document.getElementById("editVideosProductId").value);
    const product = products.find(p => p.id === productId);
    if (!product) return;
    
    const newVideoFiles = document.getElementById("newVideoFiles").files;
    if (newVideoFiles.length > 0) {
      for (let file of newVideoFiles) {
        const reader = new FileReader();
        reader.onload = function(e) {
          product.videos.push(e.target.result);
          if (product.videos.length === product.videos.filter(v => v).length + newVideoFiles.length) {
            localStorage.setItem("dreamtime_products", JSON.stringify(products));
            alert("تم تحديث الفيديوهات بنجاح!");
            closeEditVideosModal();
            showVideoSection();
          }
        };
        reader.readAsDataURL(file);
      }
    } else {
      alert("لم يتم إضافة فيديوهات جديدة.");
    }
  }

  function closeEditVideosModal() {
    document.getElementById("editVideosModal").style.display = "none";
    document.getElementById("newVideoFiles").value = "";
    document.getElementById("newVideosPreview").innerHTML = "";
  }

  function previewVideos(event, previewId) {
    const files = event.target.files;
    const preview = document.getElementById(previewId);
    preview.innerHTML = "";
    for (let file of files) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const video = document.createElement("video");
        video.src = e.target.result;
        video.controls = true;
        video.style.maxWidth = "200px";
        video.style.margin = "5px";
        preview.appendChild(video);
      };
      reader.readAsDataURL(file);
    }
  }

  // تعديل دالة الحفظ الأولية لدعم الفيديوهات
  function saveProduct() {
    const name = document.getElementById("newName").value;
    const price = parseFloat(document.getElementById("newPrice").value);
    const desc = document.getElementById("newDesc").value;
    const imageFiles = document.getElementById("newImageFiles").files;
    const videoFiles = document.getElementById("newVideoFiles").files; // إضافة الفيديوهات
    const type = document.getElementById("newType").value;

    if (!name || !price || !type || imageFiles.length === 0) {
      alert("يرجى ملء جميع الحقول وإضافة صور.");
      return;
    }

    const images = [];
    const videos = [];

    // تحميل الصور
    for (let i = 0; i < imageFiles.length; i++) {
      const file = imageFiles[i];
      const reader = new FileReader();
      reader.onload = function(e) {
        images.push(e.target.result); // حفظ الصورة كـ Base64
        if (images.length === imageFiles.length && videos.length === videoFiles.length) {
          // إنشاء المنتج بعد تحميل جميع الصور والفيديوهات
          const id = products.length ? Math.max(...products.map(p => p.id)) + 1 : 1;
          const product = {
            id,
            name,
            price,
            description: desc,
            image: images[0], // الصورة الرئيسية
            images, // جميع الصور
            videos, // جميع الفيديوهات
            type
          };
          products.push(product);
          localStorage.setItem("dreamtime_products", JSON.stringify(products));
          alert("تم حفظ المنتج!");
          showSection('products');
        }
      };
      reader.readAsDataURL(file); // تحويل الصورة إلى Base64
    }

    // تحميل الفيديوهات
    for (let i = 0; i < videoFiles.length; i++) {
      const file = videoFiles[i];
      const reader = new FileReader();
      reader.onload = function(e) {
        videos.push(e.target.result); // حفظ الفيديو كـ Base64
        if (images.length === imageFiles.length && videos.length === videoFiles.length) {
          // إنشاء المنتج بعد تحميل جميع الصور والفيديوهات
          const id = products.length ? Math.max(...products.map(p => p.id)) + 1 : 1;
          const product = {
            id,
            name,
            price,
            description: desc,
            image: images[0], // الصورة الرئيسية
            images, // جميع الصور
            videos, // جميع الفيديوهات
            type
          };
          products.push(product);
          localStorage.setItem("dreamtime_products", JSON.stringify(products));
          alert("تم حفظ المنتج!");
          showSection('products');
        }
      };
      reader.readAsDataURL(file); // تحويل الفيديو إلى Base64
    }
  }

  // تعديل دالة الحفظ التعديلي لدعم الفيديوهات
  function saveEditedProduct() {
    const id = parseInt(document.getElementById("editProductId").value);
    const name = document.getElementById("editName").value;
    const price = parseFloat(document.getElementById("editPrice").value);
    const desc = document.getElementById("editDesc").value;
    const type = document.getElementById("editType").value;

    if (!name || !price || !type) {
      alert("يرجى ملء جميع الحقول.");
      return;
    }

    const index = products.findIndex(p => p.id === id);
    if (index !== -1) {
      const imageFiles = document.getElementById("editImageFile").files;
      const videoFiles = document.getElementById("editVideoFiles").files; // إضافة الفيديوهات

      let updatedImages = [...products[index].images];
      let updatedVideos = [...products[index].videos];

      // تحديث الصور
      if (imageFiles.length > 0) {
        const images = [];
        for (let file of imageFiles) {
          const reader = new FileReader();
          reader.onload = function(e) {
            images.push(e.target.result);
            if (images.length === imageFiles.length) {
              updatedImages = images;
            }
          };
          reader.readAsDataURL(file);
        }
      }

      // تحديث الفيديوهات
      if (videoFiles.length > 0) {
        const videos = [];
        for (let file of videoFiles) {
          const reader = new FileReader();
          reader.onload = function(e) {
            videos.push(e.target.result);
            if (videos.length === videoFiles.length) {
              updatedVideos = videos;
            }
          };
          reader.readAsDataURL(file);
        }
      }

      products[index] = {
        ...products[index],
        name,
        price,
        description: desc,
        type,
        images: updatedImages,
        videos: updatedVideos
      };

      localStorage.setItem("dreamtime_products", JSON.stringify(products));
      alert("تم تحديث المنتج!");
      showSection('products');
      closeEditModal();
    }
  }
  // بدلًا من localStorage.setItem، أرسل البيانات عبر API
fetch('/api/products', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(newProduct)
});
useEffect(() => {
  fetch('/api/products')
    .then(res => res.json())
    .then(data => setProducts(data));
}, []);
// مثال باستخدام Node.js/Express
app.use((req, res, next) => {
  res.header("Access-Control-Allow-Origin", "*");
  res.header("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
  next();
});
async function saveProduct() {
  const name = document.getElementById("newName").value;
  const price = parseFloat(document.getElementById("newPrice").value);
  const desc = document.getElementById("newDesc").value;
  const imageFiles = document.getElementById("newImageFiles").files;
  const type = document.getElementById("newType").value;

  if (!name || !price || !type || imageFiles.length === 0) {
    alert("يرجى ملء جميع الحقول وإضافة صور.");
    return;
  }

  // تحويل الصور إلى Base64
  const images = [];
  for (let file of imageFiles) {
    const base64 = await fileToBase64(file);
    images.push(base64);
  }

  const newProduct = {
    id: Date.now(), // معرف فريد مؤقت
    name,
    price,
    description: desc,
    image: images[0],
    images,
    type
  };

  // إرسال المنتج إلى الخادم
  try {
    const response = await fetch('http://localhost:3000/api/products', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(newProduct)
    });
    if (response.ok) {
      alert("تم حفظ المنتج!");
      showSection('products');
    }
  } catch (error) {
    console.error("فشل في حفظ المنتج:", error);
  }
}

// دالة لتحويل الملف إلى Base64
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
    reader.readAsDataURL(file);
  });
}
const cors = require('cors');
app.use(cors({
  origin: ['http://localhost:8080', 'http://localhost:3000'] // أضف منصاتك هنا
}));
</script>
</html>